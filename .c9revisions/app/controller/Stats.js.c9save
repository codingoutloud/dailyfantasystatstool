{"ts":1340374405662,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"Ext.define('DFST.controller.Stats', {\n    extend: 'Ext.app.Controller',\n\n    stores: ['Stats', 'PlayerStats'],\n\n    models: ['StatSet', 'PlayerStatSet'],\n\n    views: ['statset.Grid', 'statset.PlayerGrid', 'drilldown.Details', 'drilldown.DetailInfo'],\n\n    refs: [{\n    \tref: 'drilldowndetails',\n    \tselector: 'drilldowndetails'\n    }, {\n        ref: 'drilldowninfo',\n    \tselector: 'drilldowninfo'\n    }],\n\n    init: function() {\n        // Set up service URLs\n        var host = 'http://localhost:49533';    //local\n        if (location.hostname.indexOf('cloudapp.net') > 0) {\n            host = 'http://dfst.cloudapp.net';  //live azure\n        }\n//        host = 'http://localhost:81';       //local azure dev fabric \n        var statsStore = this.getStatsStore();\n        var playerStatsStore = this.getPlayerStatsStore();\n        statsStore.proxy.url = host + '/api/players/';\n        playerStatsStore.proxy.url = host + '/api/playerstats/';\n\n        this.control({\n            'statsetgrid': {\n                selectionchange: this.drillDown\n            },\n            'statsetgrid > tableview': {\n                itemdblclick: this.loadStatSet,\n                refresh: this.selectStatSet\n            }\n        });\n    },\n    \n    selectStatSet: function(view) {\n        var first = this.getStatsStore().getAt(0);\n        if (first) {\n            view.getSelectionModel().select(first);\n        }\n    },\n\n    /**\n     * Loads the given statset into the drilldown view\n     * @param {DFST.model.StatSet} statset The statset to load\n     */\n    drillDown: function(grid, statsets) {\n        var statset = statsets[0],\n            detailsInfoView = this.getDrilldowninfo(),\n            detailsView = this.getDrilldowndetails(),\n            siteId=this.getStatsStore().filters.get(\"scoring\").value,\n            store;\n\n        if (statset && detailsView) {\n            store = this.getPlayerStatsStore();\n            store.filter([\n                {id:'id', property: 'id', value: statset.data.id},\n                {id:'scoring', property: 'scoring', value: siteId}\n            ]);\n            detailsInfoView.statset = statset;\n            detailsInfoView.update(statset.data);\n            detailsView.setTitle('Game Details: ' + statset.data.name);\n            detailsView.show();\n        }\n    }});\n\n"]],"start1":0,"start2":0,"length1":0,"length2":2307}]],"length":2307}
